<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SmallRye Reactive Messaging</title>
    <meta name="generator" content="Antora 2.3.0-beta.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">SmallRye Reactive Messaging</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Project</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/smallrye/smallrye-reactive-messaging">Source Code</a>
            <a class="navbar-item" href="https://github.com/smallrye/smallrye-reactive-messaging/issues">Issue Tracker</a>
          </div>
        </div>
        <a class="navbar-item" href="https://smallrye.io/" alt=>A SmallRye.io Project</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="smallrye-reactive-messaging" data-version="3.8">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">SmallRye Reactive Messaging</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts.html#messages">Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts.html#channels">Channels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts.html#connectors">Connectors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../model/model.html">Development Model</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#overview">Incoming and Outgoing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#messages">Creating Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#generating-messages">Generating messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#generating-payloads">Generating payloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#consuming-messages">Consuming messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#consuming-payloads">Consuming payloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#processing-messages">Processing messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#processing-payloads">Processing payloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#processing-streams">Processing streams</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#skipping">Skipping messages or payloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../model/model.html#converters">Converting messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../acknowledgement/acknowledgement.html">Acknowledgement</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/broadcast.html">Broadcasting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/merge.html">Merging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/incomings.html">Multiple @Incoming</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/blocking.html">Handling blocking execution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../signatures/signatures.html">Method signatures</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../connectors/connectors.html">Connectors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kafka/kafka.html">Apache Kafka</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-installation">Using the connector</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-inbound">Receiving Kafka Records</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-outbound">Writing Kafka Records</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-health">Health Check</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-avro-configuration">Using Avro</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-client-service">Accessing the Kafka client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../kafka/kafka.html#kafka-kerberos">Kerberos authentication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amqp/amqp.html">AMQP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-installation">Using the connector</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-inbound">Receiving AMQP Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-outbound">Sending AMQP Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-customization">Configuring the client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-health">Health Check</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../amqp/amqp.html#amqp-rabbitmq">Connecting with RabbitMQ</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="camel.html">Apache Camel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#camel-installation">Using the connector</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#camel-inbound">Receiving data using Camel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#camel-outbound">Sending data using Camel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#camel-api">Using existing routes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jms/jms.html">JMS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jms/jms.html#jms-installation">Using the connector</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jms/jms.html#jms-inbound">Receiving JMS Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jms/jms.html#jms-outbound">Sending JMS Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jms/jms.html#jms-configuration">Advanced configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../mqtt/mqtt.html">MQTT</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mqtt/mqtt.html#mqtt-installation">Using the connector</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mqtt/mqtt.html#mqtt-inbound">Receiving MQTT Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mqtt/mqtt.html#mqtt-outbound">Sending MQTT Messages</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#mqtt-server:mqtt-server.adoc">Exposing an MQTT server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../emitter/emitter.html">Emitters and Channels</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../emitter/emitter.html#emitter-payloads">Sending payloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../emitter/emitter.html#emitter-messages">Sending messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../emitter/emitter.html#emitter-overflow">Managing overflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../emitter/emitter.html#streams">Injecting channels</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../testing/testing.html">Testing applications</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../advanced/advanced.html">Advanced topics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/advanced.html#logging">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../advanced/advanced.html#strict">Strict mode</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<!-- This is the default navigation panel in the bottom left corner. We aren't using it, but let's keep it commented out
    should we change our minds about it -->
<!--
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">SmallRye Reactive Messaging</span>
    <span class="version">3.8</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">SmallRye Reactive Messaging</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">3.8</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
-->
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">SmallRye Reactive Messaging</a></li>
    <li><a href="../connectors/connectors.html">Connectors</a></li>
    <li><a href="camel.html">Apache Camel</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1 class="page">Integration with Apache Camel</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Camel connector adds support for Apache Camel to Reactive Messaging.</p>
</div>
<div class="paragraph">
<p><a href="https://camel.apache.org/">Camel</a> is an open source integration framework let you integrate various systems consuming or producing data.
Camel implements the Enterprise Integration Patterns and provides several hundred of components used to access databases, message queues, APIs or basically <a href="https://camel.apache.org/components/latest/">anything under the sun</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Camel is not a messaging broker.
But, it allows your Reactive Messaging application to retrieve data from almost anything and send data to almost anything.</p>
</div>
<div class="paragraph">
<p>So if you want to send Reactive Messaging <code>Message</code> to Telegram or retrieve data from Salesforce or SAP, this is the connector you need.</p>
</div>
<div class="paragraph">
<p>One of the Camel cornerstone is the <code>endpoint</code> and its <code>uri</code> encoding the connection to an external system.
For example, <code>file:orders/?delete=true&amp;charset=utf-8</code> instructs Camel to read the files from the <code>orders</code> directory.
URI format and parameters are listed on the component documentation, such as the <a href="https://camel.apache.org/components/latest/file-component.html">File component</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-installation"><a class="anchor" href="#camel-installation"></a>Using the camel connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To you the camel Connector, add the following dependency to your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-reactive-messaging-camel&lt;/artifactId&gt;
  &lt;version&gt;3.8.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will also need the dependency of the Camel component you are using.
For example, if you want to process files, you would need to add the Camel File Component artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
  &lt;artifactId&gt;camel-file&lt;/artifactId&gt;
  &lt;version&gt;3.11.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connector name is: <code>smallrye-camel</code>.</p>
</div>
<div class="paragraph">
<p>So, to indicate that a channel is managed by this connector you need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Inbound
mp.messaging.incoming.[channel-name].connector=smallrye-camel

# Outbound
mp.messaging.outgoing.[channel-name].connector=smallrye-camel</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-inbound"><a class="anchor" href="#camel-inbound"></a>Retrieving data using Camel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Camel provides many components.
To keep this documentation focused on the integration with Camel, we use the <a href="https://camel.apache.org/components/latest/file-component.html">File component</a>.
This component let use read files from a directory.
So the connector configured with this component creates a <code>Message</code> for each file located in the directory.
As soon as a file is dropped in the directory, a new <code>Message</code> is created.</p>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>Example</h3>
<div class="paragraph">
<p>Let&#8217;s imagine you want to read the files from the <code>orders</code> directory and send them to the <code>files</code> channel.
Configuring the Camel connector to gets the <em>file</em> from this directory only requires 2 properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mp.messaging.incoming.files.connector=smallrye-camel       <i class="conum" data-value="1"></i><b>(1)</b>
mp.messaging.incoming.files.endpoint-uri=file:orders/?delete=true&amp;charset=utf-8 <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sets the connector for the <code>files</code> channel</p>
</li>
<li>
<p>Configures the <code>endpoint-uri</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then, your application receives <code>Message&lt;GenericFile&lt;File&gt;&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Camel File component produces <code>org.apache.camel.component.file.GenericFile</code> instances. You can retrieve the actual <code>File</code> using <code>getFile()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can consumes the payload directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package inbound;

import org.apache.camel.component.file.GenericFile;
import org.eclipse.microprofile.reactive.messaging.Incoming;

import javax.enterprise.context.ApplicationScoped;
import java.io.File;

@ApplicationScoped
public class CamelFileConsumer {

    @Incoming("files")
    public void consume(GenericFile&lt;File&gt; gf) {
        File file = gf.getFile();
        // process the file

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also retrieve the <code>Message&lt;GenericFile&lt;File&gt;&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package inbound;

import org.apache.camel.component.file.GenericFile;
import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Message;

import javax.enterprise.context.ApplicationScoped;
import java.io.File;
import java.util.concurrent.CompletionStage;

@ApplicationScoped
public class CamelFileMessageConsumer {

    @Incoming("files")
    public CompletionStage&lt;Void&gt; consume(Message&lt;GenericFile&lt;File&gt;&gt; msg) {
        File file = msg.getPayload().getFile();
        // process the file

        return msg.ack();
    }


}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deserialization"><a class="anchor" href="#_deserialization"></a>Deserialization</h3>
<div class="paragraph">
<p>Each Camel component is producing specific objects.
As we have seen, the File component produces <code>GenericFile</code>.</p>
</div>
<div class="paragraph">
<p>Refer to the component documentation to check which type is produced.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inbound_metadata"><a class="anchor" href="#_inbound_metadata"></a>Inbound Metadata</h3>
<div class="paragraph">
<p>Messages coming from Camel contains an instance of <a href="https://smallrye.io/smallrye-reactive-messaging/3.8.0/apidocs/io/smallrye/reactive/messaging/camel/IncomingExchangeMetadata.html"><code>IncomingExchangeMetadata</code></a> in the metadata.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package inbound;

import io.smallrye.reactive.messaging.camel.IncomingExchangeMetadata;
import org.apache.camel.Exchange;
import org.apache.camel.component.file.GenericFile;
import org.eclipse.microprofile.reactive.messaging.Incoming;
import org.eclipse.microprofile.reactive.messaging.Message;

import javax.enterprise.context.ApplicationScoped;
import java.io.File;
import java.util.Optional;
import java.util.concurrent.CompletionStage;

@ApplicationScoped
public class IncomingCamelMetadataExample {

    @Incoming("files")
    public CompletionStage&lt;Void&gt; consume(Message&lt;GenericFile&lt;File&gt;&gt; msg) {
        Optional&lt;IncomingExchangeMetadata&gt; metadata = msg.getMetadata(IncomingExchangeMetadata.class);
        if (metadata.isPresent()) {
            // Retrieve the camel exchange:
            Exchange exchange = metadata.get().getExchange();
        }
        return msg.ack();
    }


}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This object lets you retrieve the Camel <code>Exchange</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_failure_management"><a class="anchor" href="#_failure_management"></a>Failure Management</h3>
<div class="paragraph">
<p>If a message produced from a Camel exchange  is <em>nacked</em>, a failure strategy is applied.
The Camel connector supports 3 strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fail</code> - fail the application, no more MQTT messages will be processed. (default)
The offset of the record that has not been processed correctly is not committed.</p>
</li>
<li>
<p><code>ignore</code> - the failure is logged, but the processing continue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the <code>exchange</code> is marked as rollback only and the nack reason is attached to the exchange.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_reference"><a class="anchor" href="#_configuration_reference"></a>Configuration Reference</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Incoming Attributes of the 'smallrye-camel' connector</caption>
<colgroup>
<col style="width: 27.7777%;">
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 22.2224%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute (<em>alias</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>endpoint-uri</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI of the Camel endpoint (read from or written to)</p>
<p class="tableblock">Type: <em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>failure-strategy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the failure strategy to apply when a message produced from a Camel exchange is nacked. Values can be <code>fail</code> (default) or <code>ignore</code></p>
<p class="tableblock">Type: <em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fail</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-outbound"><a class="anchor" href="#camel-outbound"></a>Sending data with Camel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the Camel connector to send data to almost any type of system.</p>
</div>
<div class="paragraph">
<p>To keep this document focused on the Camel connector, we use the Camel File component.
However, the connector can be used with any Camel component.</p>
</div>
<div class="sect2">
<h3 id="_example_2"><a class="anchor" href="#_example_2"></a>Example</h3>
<div class="paragraph">
<p>Let&#8217;s imagine you want to write generated prices into files.
Configure your application to write the messages from the <code>prices</code> channel into a files as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>mp.messaging.outgoing.prices.connector=smallrye-camel <i class="conum" data-value="1"></i><b>(1)</b>
mp.messaging.outgoing.prices.endpoint-uri=file:prices/?fileName=${date:now:yyyyMMddssSS}.txt&amp;charset=utf-8</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sets the connector for the <code>prices</code> channel</p>
</li>
<li>
<p>Configure the <code>endpoint-uri</code> to write into files in the <code>prices</code> directory</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Depending on your implementation of MicroProfile Reactive Messaging, the <code>$</code> may need to be escaped as follows: <code>$${&#8230;&#8203;}</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, your application must send <code>Message&lt;String&gt;</code> to the <code>prices</code> channel.
It can use <code>String</code> payloads as in the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package outbound;

import io.smallrye.mutiny.Multi;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

import javax.enterprise.context.ApplicationScoped;
import java.time.Duration;
import java.util.Random;

@ApplicationScoped
public class CamelPriceProducer {

    private Random random = new Random();

    @Outgoing("prices")
    public Multi&lt;String&gt; generate() {
        // Build an infinite stream of random prices
        return Multi.createFrom().ticks().every(Duration.ofSeconds(1))
            .onOverflow().drop()
            .map(x -&gt; random.nextDouble())
            .map(p -&gt; Double.toString(p));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can send <code>Message&lt;Double&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package outbound;

import io.smallrye.mutiny.Multi;
import org.eclipse.microprofile.reactive.messaging.Message;
import org.eclipse.microprofile.reactive.messaging.Outgoing;

import javax.enterprise.context.ApplicationScoped;
import java.time.Duration;
import java.util.Random;

@ApplicationScoped
public class CamelPriceMessageProducer {

    private Random random = new Random();

    @Outgoing("prices")
    public Multi&lt;Message&lt;String&gt;&gt; generate() {
        // Build an infinite stream of random prices
        return Multi.createFrom().ticks().every(Duration.ofSeconds(1))
            .map(x -&gt; random.nextDouble())
            .map(p -&gt; Double.toString(p))
            .map(Message::of);
    }


}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_serialization"><a class="anchor" href="#_serialization"></a>Serialization</h3>
<div class="paragraph">
<p>The serialization is handled by the Camel component.
Refer to the Camel documentation to check which payload type is supported by the component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_outbound_metadata"><a class="anchor" href="#_outbound_metadata"></a>Outbound Metadata</h3>
<div class="paragraph">
<p>When sending <code>Messages</code>, you can add an instance of <a href="https://smallrye.io/smallrye-reactive-messaging/3.8.0/apidocs/apidocs/io/smallrye/reactive/messaging/camel/OutgoingExchangeMetadata.html"><code>OutgoingExchangeMetadata</code></a> to the message metadata.
You can then influence how the outbound Camel <code>Exchange</code> is created, for example by adding properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        return Multi.createFrom().ticks().every(Duration.ofSeconds(1))
            .map(x -&gt; random.nextDouble())
            .map(p -&gt; Double.toString(p))
            .map(s -&gt;
                Message.of(s)
                    .addMetadata(new OutgoingExchangeMetadata().putProperty("my-property", "my-value"))
            );</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgement"><a class="anchor" href="#_acknowledgement"></a>Acknowledgement</h3>
<div class="paragraph">
<p>The incoming messages are acknowledged when the underlying Camel exchange completes.
If the exchange fails, the message is nacked.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_reference_2"><a class="anchor" href="#_configuration_reference_2"></a>Configuration Reference</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Outgoing Attributes of the 'smallrye-camel' connector</caption>
<colgroup>
<col style="width: 27.7777%;">
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 22.2224%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute (<em>alias</em>)</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Mandatory</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>endpoint-uri</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI of the Camel endpoint (read from or written to)</p>
<p class="tableblock">Type: <em>string</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>merge</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the connector should allow multiple upstreams</p>
<p class="tableblock">Type: <em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="camel-api"><a class="anchor" href="#camel-api"></a>Using the Camel API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Camel connector is based on the <a href="https://camel.apache.org/components/latest/reactive-streams-component.html">Reactive Streams support</a> from Camel.
If you have an application already using the Camel API (routes, <code>from</code>&#8230;&#8203;), you can integrate it with Reactive Messaging.</p>
</div>
<div class="sect2">
<h3 id="_getting_the_camelreactivestreamsservice"><a class="anchor" href="#_getting_the_camelreactivestreamsservice"></a>Getting the CamelReactiveStreamsService</h3>
<div class="paragraph">
<p>Once you add the Camel connector to your application, you can retrieve the <code>org.apache.camel.component.reactive.streams.api.CamelReactiveStreamsService</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject CamelReactiveStreamsService reactiveStreamsService;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>CamelReactiveStreamsService</code> lets you create <code>Publisher</code> and <code>Subscriber</code> instances from existing routes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_camel_route_with_outgoing"><a class="anchor" href="#_using_camel_route_with_outgoing"></a>Using Camel Route with @Outgoing</h3>
<div class="paragraph">
<p>If you have an existing Camel route, you can transform it as a <code>Publisher</code> using the <code>CamelReactiveStreamsService</code>.
Then, you can return this <code>Publisher</code> from a method annotated with <code>@Outgoing</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Outgoing("camel")
public Publisher&lt;Exchange&gt; retrieveDataFromCamelRoute() {
    return reactiveStreamsService.from("seda:camel");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>RouteBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
static class MyRouteBuilder extends RouteBuilder {
    @Inject CamelReactiveStreamsService reactiveStreamsService;

    @Outgoing("sink")
    public Publisher&lt;String&gt; getDataFromCamelRoute() {
        return reactiveStreamsService.fromStream("my-stream", String.class);
    }

    @Override
    public void configure() throws Exception {
        from("seda:camel").process(
            exchange -&gt; exchange.getMessage().setBody(exchange.getIn().getBody(String.class).toUpperCase()))
            .to("reactive-streams:my-stream");
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_camel_route_with_incoming"><a class="anchor" href="#_using_camel_route_with_incoming"></a>Using Camel Route with @Incoming</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have an existing Camel route, you can transform it as a <code>Subscriber</code> using the <code>CamelReactiveStreamsService</code>.
Then, you can return this <code>Subscriber</code> from a method annotated with <code>@Incoming</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Incoming("to-camel")
    public Subscriber&lt;String&gt; sendDataToCamelRoute() {
        return reactiveStreamsService.subscriber("file:./target?fileName=values.txt&amp;fileExist=append",
            String.class);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a producer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Inject CamelContext camel;

    @Incoming("to-camel")
    public CompletionStage&lt;Void&gt; sink(String value) {
        return camel.createProducerTemplate()
            .asyncSendBody("file:./target?fileName=values.txt&amp;fileExist=append", value).thenApply(x -&gt; null);
    }</code></pre>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>SmallRye Reactive Messaging is licensed until the terms of the Apache Software License 2.0</p>
  <p>Access the source code from the <a href="https://github.com/smallrye/smallrye-reactive-messaging">GitHub repository</a>.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
